<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../user-list/user-list.html">
<link rel="import" href="../post-form/post-form.html">
<link rel="import" href="../post-list/post-list.html">
<link rel="import" href="../nav-bar/nav-bar.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">

<dom-module id="dashboard-app">
    <template>
        <style>
            .container {
                display: flex;
                outline: 3px solid red;
            }

            user-list {
                background-color: aqua;
                flex-grow: 1;

            }

            .cont {
                flex-grow: 4;
            }

            @media (max-width: 425px) {
                .container {
                    flex-direction: column;
                }
            }
        </style>
        <iron-ajax auto url="https://posts-services.herokuapp.com/users" handle-as="json" last-response="{{response}}"></iron-ajax>
        <nav-bar></nav-bar>
        <div class="container">
            <user-list users="[[usersWithoutMe]]"></user-list>

            <div class="cont">
                <post-form></post-form>
                <post-list post-arr="[[usersWithoutMe.0.posts]]"></post-list>
            </div>
        </div>

    </template>
    <script>
        (function dashboardApp(customElements) {
            class DashboardApp extends Polymer.Element {
                static get is() {
                    return 'dashboard-app'
                }

                static get properties() {
                    return {
                        users: Array,
                        response: Array,
                        usersList: {
                            computed: '_filterUsers(response)'
                        },
                        usersWithoutMe: Array
                    }
                }

                _filterUsers(response) {
                    let arr = [];
                    if (response) {
                        response.forEach(user => {
                            if (user) {
                                arr.push(user)
                            }
                        });
                        console.log(response, '***')

                    }
                    this.usersWithoutMe = arr;
                    console.log(arr)
                }


            }
            customElements.define(DashboardApp.is, DashboardApp);

        })(window.customElements);
    </script>
</dom-module>