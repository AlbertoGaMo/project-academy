<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../user-list/user-list.html">
<link rel="import" href="../post-form/post-form.html">
<link rel="import" href="../post-list/post-list.html">

<dom-module id="dashboard-app">
    <template>
        <style>
            .container {
                display: flex;
                outline: 3px solid red;
            }

            user-list {
                flex-grow: 1;
            }

            .cont {
                flex-grow: 4;
            }

            @media (max-width: 425px) {
                .container {
                    flex-direction: column;
                }
            }
        </style>

        <h1>[[currentUser]]</h1>
        <div class="container">
            <user-list users="[[usersWithoutMe]]"></user-list>

            <div class="cont">
                <post-form></post-form>
                <post-list post-arr="[[currentPosts]]"></post-list>
            </div>
        </div>

    </template>
    <script>
        class DashboardApp extends Polymer.Element {

            static get is() {
                return 'dashboard-app'
            }

            static get properties() {
                return {
                    users: Array,
                    response: Array,
                    usersList: {
                        computed: '_filterUsers(response)'
                    },
                    usersWithoutMe: Array,
                    currentUser: String,
                    currentPosts: {
                        computed: '_getCurrentPosts(currentUser)'
                    }
                }
            }

            ready() {
                this.addEventListener('user-card-click', this._changeSelectedUser);
                super.ready();
            }

            _filterUsers(response) {
                let arr = [];
                if (response) {
                    response.forEach(user => {
                        if (user) {
                            arr.push(user)
                        }
                    });
                    console.log(response, '***')

                }
                this.usersWithoutMe = arr;
                this.currentUser = arr[0].name;
                console.log(arr)
            }

            _changeSelectedUser(e) {
                this.currentUser = e.detail.userName
            }

            _getCurrentPosts(currentUser) {
                let posts;
                this.usersWithoutMe.forEach(user => {
                    if (user.name == this.currentUser) {
                        posts = user.posts
                    }
                });
                return posts
            }


        }

        window.customElements.define(DashboardApp.is, DashboardApp);
    </script>
</dom-module>