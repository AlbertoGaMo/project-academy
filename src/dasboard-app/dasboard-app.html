<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../user-list/user-list.html">
<link rel="import" href="../post-form/post-form.html">
<link rel="import" href="../post-list/post-list.html">

<link rel="import" href="/bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="/src/dropdown-menu/dropdown-menu.html">


<dom-module id="dashboard-app">
    <template>
        <style>
            .container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            app-toolbar {
                background-color: #4285f4;
                color: #fff;
            }

            app-header {
                @apply --layout-fixed-top;
                color: #fff;
                --app-header-background-rear-layer: {
                    background-color: #ef6c00;
                }
                ;
            }

            app-drawer {
                --app-drawer-scrim-background: rgba(0, 0, 100, 0.8);
                --app-drawer-content-container: {
                    background-color: #B0BEC5;
                    width: 40%;
                    overflow: scroll;
                }
                ;
                z-index:+10;
            }

            sample-content {
                padding-top: 64px;
            }

            post-list {
                width: 100%;
            }

            post-form {
                display: flex;
                justify-content: center;
            }
        </style>

        <app-header reveals>
            <app-toolbar>
                <paper-button icon="menu" on-click="_toggleDrawer">Users</paper-button>
                <div main-title>Queta Blog</div>
                <dropdown-menu></dropdown-menu>
            </app-toolbar>
        </app-header>
        <app-drawer id="drawer" swipe-open>
            <user-list users="[[usersArr]]"></user-list>
        </app-drawer>

        <div class="container">
            <post-form pather="[[pather]]"></post-form>
            <post-list post-arr="[[currentPosts]]"></post-list>
        </div>

    </template>
    <script>
        class DashboardApp extends Polymer.Element {

            static get is() {
                return 'dashboard-app'
            }

            static get properties() {
                return {
                    users: Array,
                    response: Array,
                    usersList: {
                        computed: '_filterUsers(response)'
                    },
                    usersArr: Array,
                    currentUser: String,
                    currentPosts: {
                        notify: true,
                        computed: '_getCurrentPosts(currentUser)'
                    },
                    loggedinUser: String,
                    pather:Object
                }
            }

            ready() {
                super.ready();
                this.addEventListener('user-card-click', this._changeSelectedUser);
                this.set('pather',this);
            }



            _filterUsers(response) {
                let arr = [];
                if (response) {
                    response.forEach(user => {
                        if (user) {
                            if (user.email === this.loggedinUser.email) {
                                user.isMainUser = 'mainusr';
                            }

                            arr.push(user)
                        }
                    });

                }
                this.usersArr = arr;
                this.currentUser = this.loggedinUser.name;
                console.log(arr)
            }

            _changeSelectedUser(e) {
                this.currentUser = e.detail.userName;
                this.$.drawer.toggle()
            }

            _toggleDrawer() {
                this.$.drawer.toggle()
            }

            _getCurrentPosts(currentUser) {
                let posts;
                this.usersArr.forEach(user => {
                    if (user.name == this.currentUser) {
                        posts = user.posts
                    }
                });
                return posts
            }


        }

        window.customElements.define(DashboardApp.is, DashboardApp);
    </script>
</dom-module>