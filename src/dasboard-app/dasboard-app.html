<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../user-list/user-list.html">
<link rel="import" href="../post-form/post-form.html">
<link rel="import" href="../post-list/post-list.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">

<dom-module id="dashboard-app">
    <template>
        <style>
            .container {
                display: flex;
                outline: 3px solid red;
            }

            user-list {
                flex-grow: 1;
            }

            .cont {
                flex-grow: 4;
            }

            @media (max-width: 425px) {
                .container {
                    flex-direction: column;
                }
            }
        </style>
        <iron-ajax auto url="https://posts-services.herokuapp.com/users" handle-as="json" last-response="{{response}}"></iron-ajax>
        <h1>[[currentUser]]</h1>
        <div class="container">
            <user-list users="[[usersWithoutMe]]"></user-list>

            <div class="cont">
                <post-form></post-form>
                <post-list post-arr="[[currentPosts]]"></post-list>
            </div>
        </div>

    </template>
    <script>
        (function dashboardApp(customElements) {
            class DashboardApp extends Polymer.Element {

                ready() {
                    this.addEventListener('user-card-click', this._changeSelectedUser);
                    super.ready();
                }

                static get is() {
                    return 'dashboard-app'
                }

                static get properties() {
                    return {
                        users: Array,
                        response: Array,
                        usersList: {
                            computed: '_filterUsers(response)'
                        },
                        usersWithoutMe: Array,
                        currentUser: String,
                        currentPosts: {
                            computed: '_getCurrentPosts(currentUser)'
                        }
                    }
                }

                _filterUsers(response) {
                    let arr = [];
                    if (response) {
                        response.forEach(user => {
                            if (user) {
                                arr.push(user)
                            }
                        });
                        console.log(response, '***')

                    }
                    this.usersWithoutMe = arr;
                    this.currentUser = arr[0].name;
                    console.log(arr)
                }

                _changeSelectedUser(e) {
                    this.currentUser = e.detail.userName
                }

                _getCurrentPosts(currentUser) {
                    let posts;
                    this.usersWithoutMe.forEach(user => {
                        if (user.name == this.currentUser) {
                            posts = user.posts
                        }
                    });
                    return posts
                }


            }
            customElements.define(DashboardApp.is, DashboardApp);

        })(window.customElements);
    </script>
</dom-module>